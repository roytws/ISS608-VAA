{
  "hash": "21ed72530d7b6f1e28384f2138b84163",
  "result": {
    "markdown": "---\ntitle: \"Take-Home_EX03\"\nauthor: \"Teo Wee Siang Roy\"\ndate: \"June 11, 2025\"\ndate-modified: \"last-modified\"\nformat:\n  html:\n    toc: true\n    theme: default\n    code-fold: show\neditor: visual\nexecute: \n  eval: true\n  echo: true\n  warning: false\nfreeze: true\n---\n\n\n\n# Take-Home 3\n\nReplicate Take home 2 with teammates's package \n# Set-up\n\n## Import library package\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, jsonlite, lubridate, ggraph, tidygraph, visNetwork, igraph, patchwork)\n```\n:::\n\n\n## Import data and extract nodes and edges\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load graph structure\nMC3 <- fromJSON(\"TH03/data/MC3_graph.json\")\nMC3_schema <- fromJSON(\"TH03/data/MC3_schema.json\")\n\nmc3_nodes <- as_tibble(MC3$nodes)\nmc3_edges <- as_tibble(MC3$edges)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(MC3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nList of 5\n $ directed  : logi TRUE\n $ multigraph: logi FALSE\n $ graph     :List of 4\n  ..$ mode        : chr \"static\"\n  ..$ edge_default: Named list()\n  ..$ node_default: Named list()\n  ..$ name        : chr \"VAST_MC3_Knowledge_Graph\"\n $ nodes     :'data.frame':\t1159 obs. of  31 variables:\n  ..$ type             : chr [1:1159] \"Entity\" \"Entity\" \"Entity\" \"Entity\" ...\n  ..$ label            : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ name             : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ sub_type         : chr [1:1159] \"Person\" \"Person\" \"Person\" \"Person\" ...\n  ..$ id               : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ timestamp        : chr [1:1159] NA NA NA NA ...\n  ..$ monitoring_type  : chr [1:1159] NA NA NA NA ...\n  ..$ findings         : chr [1:1159] NA NA NA NA ...\n  ..$ content          : chr [1:1159] NA NA NA NA ...\n  ..$ assessment_type  : chr [1:1159] NA NA NA NA ...\n  ..$ results          : chr [1:1159] NA NA NA NA ...\n  ..$ movement_type    : chr [1:1159] NA NA NA NA ...\n  ..$ destination      : chr [1:1159] NA NA NA NA ...\n  ..$ enforcement_type : chr [1:1159] NA NA NA NA ...\n  ..$ outcome          : chr [1:1159] NA NA NA NA ...\n  ..$ activity_type    : chr [1:1159] NA NA NA NA ...\n  ..$ participants     : int [1:1159] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ thing_collected  :'data.frame':\t1159 obs. of  2 variables:\n  .. ..$ type: chr [1:1159] NA NA NA NA ...\n  .. ..$ name: chr [1:1159] NA NA NA NA ...\n  ..$ reference        : chr [1:1159] NA NA NA NA ...\n  ..$ date             : chr [1:1159] NA NA NA NA ...\n  ..$ time             : chr [1:1159] NA NA NA NA ...\n  ..$ friendship_type  : chr [1:1159] NA NA NA NA ...\n  ..$ permission_type  : chr [1:1159] NA NA NA NA ...\n  ..$ start_date       : chr [1:1159] NA NA NA NA ...\n  ..$ end_date         : chr [1:1159] NA NA NA NA ...\n  ..$ report_type      : chr [1:1159] NA NA NA NA ...\n  ..$ submission_date  : chr [1:1159] NA NA NA NA ...\n  ..$ jurisdiction_type: chr [1:1159] NA NA NA NA ...\n  ..$ authority_level  : chr [1:1159] NA NA NA NA ...\n  ..$ coordination_type: chr [1:1159] NA NA NA NA ...\n  ..$ operational_role : chr [1:1159] NA NA NA NA ...\n $ edges     :'data.frame':\t3226 obs. of  5 variables:\n  ..$ id         : chr [1:3226] \"2\" \"3\" \"5\" \"3013\" ...\n  ..$ is_inferred: logi [1:3226] TRUE FALSE TRUE TRUE TRUE TRUE ...\n  ..$ source     : chr [1:3226] \"Sam\" \"Sam\" \"Sam\" \"Sam\" ...\n  ..$ target     : chr [1:3226] \"Relationship_Suspicious_217\" \"Event_Communication_370\" \"Event_Assessment_600\" \"Relationship_Colleagues_430\" ...\n  ..$ type       : chr [1:3226] NA \"sent\" NA NA ...\n```\n:::\n:::\n\n## Clean and Wrangling nodes \n\n::: {.cell}\n\n```{.r .cell-code}\nmc3_nodes_cleaned <- mc3_nodes %>%\n  mutate(id = as.character(id)) %>%\n  filter(!is.na(id)) %>%\n  distinct(id, .keep_all = TRUE) %>%\n  select(-thing_collected)\n\nmc3_edges_cleaned <- mc3_edges %>%\n  rename(from_id = source, \n         to_id = target) %>%\n  mutate(across(c(from_id, to_id), as.character)) %>%\n  filter(from_id %in% mc3_nodes_cleaned$id, \n         to_id %in% mc3_nodes_cleaned$id) %>%\n  filter(!is.na(from_id), !is.na(to_id))\n\nnode_index_lookup <- mc3_nodes_cleaned %>%\n  mutate(.row_id = row_number()) %>%\n  select(id, .row_id)\n\nmc3_edges_indexed <- mc3_edges_cleaned %>%\n  left_join(node_index_lookup, by = c(\"from_id\" = \"id\")) %>%\n  rename(from = .row_id) %>%\n  left_join(node_index_lookup, by = c(\"to_id\" = \"id\")) %>%\n  rename(to = .row_id) %>%\n  select(from, to, is_inferred, type) %>%\n  filter(!is.na(from) & !is.na(to))\n\nused_node_indices <- sort(unique(c(mc3_edges_indexed$from, mc3_edges_indexed$to)))\n\nmc3_nodes_final <- mc3_nodes_cleaned %>%\n  slice(used_node_indices) %>%\n  mutate(new_index = row_number())\n\nold_to_new_index <- tibble(\n  old_index = used_node_indices,\n  new_index = seq_along(used_node_indices)\n)\n\nmc3_edges_final <- mc3_edges_indexed %>%\n  left_join(old_to_new_index, by = c(\"from\" = \"old_index\")) %>%\n  rename(from_new = new_index) %>%\n  left_join(old_to_new_index, by = c(\"to\" = \"old_index\")) %>%\n  rename(to_new = new_index) %>%\n  select(from = from_new, to = to_new, is_inferred, type)\n```\n:::\n\n## Parse Timestamp and Extract Day\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert timestamp to datetime and extract date\ncomm_events <- mc3_nodes_final %>%\n  filter(type == \"Event\", sub_type == \"Communication\") %>%\n  select(id, timestamp)\n\n# Step 2: Parse timestamp into datetime and extract the date\ncomm_events <- comm_events %>%\n  mutate(\n    start_time = ymd_hms(timestamp, quiet = TRUE),\n    day = as.Date(start_time)\n  )\n```\n:::\n\n\n## Summarise daily Communication Volume\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count number of communications per day\ndaily_comms <- comm_events %>%\n  count(day, name = \"num_comms\")\n```\n:::\n\n\n## Visualise the Temporal Pattern\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot as a time series\nggplot(daily_comms, aes(x = day, y = num_comms)) +\n  geom_line(color = \"steelblue\", linewidth = 1.2) +\n  geom_point(size = 2) +\n  labs(title = \"Daily Communication Patterns (2-Week Period)\",\n       x = \"Date\", y = \"Number of Communications\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex03_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n# Question 2\n\n## Filter People + Vessels only\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter relevant entity nodes\nentity_nodes <- mc3_nodes_final %>%\n  filter(type == \"Entity\", sub_type %in% c(\"Person\", \"Vessel\")) %>%\n  select(id, name, sub_type)\n```\n:::\n\n\n## Assign groups based on name/subtype for better analytics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nentity_nodes <- entity_nodes %>%\n  mutate(\n    group = case_when(\n      name %in% c(\"Green Guardians\", \"Reef Guardian\", \"EcoVigil\", \"Sentinel\") ~ \"Environmentalism\",\n      name %in% c(\"Sailor Shift\", \"Sailor Shifts Team\") ~ \"Sailor Shift\",\n      name %in% c(\"Mariners Dream\", \"Marlin\", \"Recreational Fishing Boats\") ~ \"Fishing/Leisure\",\n      name %in% c(\"Serenity\", \"Horizon\", \"Osprey\", \"Remora\", \"Neptune\", \"Mako\") ~ \"Tourism/Leisure\",\n      TRUE ~ sub_type\n    )\n  )\n```\n:::\n\n\n## Filter Edges Between People and Vessels (Communication events)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvalid_ids <- entity_nodes$id\n\ncomm_event_ids <- mc3_nodes_final %>%\n  filter(type == \"Event\", sub_type == \"Communication\") %>%\n  pull(id)\n\n# Use the cleaned edge indices and map back to node IDs\nedge_lookup <- tibble(\n  index = mc3_nodes_final$new_index,\n  id = mc3_nodes_final$id\n)\n\nmc3_edges_for_events <- mc3_edges_final %>%\n  left_join(edge_lookup, by = c(\"from\" = \"index\")) %>%\n  rename(from_id = id) %>%\n  left_join(edge_lookup, by = c(\"to\" = \"index\")) %>%\n  rename(to_id = id)\n\nsent_edges <- mc3_edges_for_events %>%\n  filter(type == \"sent\", to_id %in% comm_event_ids) %>%\n  select(event_id = to_id, entity_id = from_id)\n\nreceived_edges <- mc3_edges_for_events %>%\n  filter(type == \"received\", from_id %in% comm_event_ids) %>%\n  select(event_id = from_id, entity_id = to_id)\n\nentity_event_edges <- bind_rows(sent_edges, received_edges)\n\nentity_pairs <- entity_event_edges %>%\n  inner_join(entity_event_edges, by = \"event_id\") %>%\n  filter(entity_id.x != entity_id.y) %>%\n  distinct(entity_id.x, entity_id.y) %>%\n  rename(source = entity_id.x, target = entity_id.y) %>%\n  filter(source %in% valid_ids & target %in% valid_ids)\n```\n:::\n\n\n## Build and Cluster Graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngraph_tbl <- tbl_graph(nodes = entity_nodes, edges = entity_pairs, directed = FALSE)\n\ngraph_tbl <- graph_tbl %>%\n  mutate(cluster = as.factor(group_infomap()))\n```\n:::\n\n\n## Visualise Groups\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggraph(graph_tbl, layout = \"fr\") +\n  geom_edge_link(alpha = 0.2) +\n  geom_node_point(aes(color = group, shape = sub_type), size = 4) +\n  geom_node_text(aes(label = name), repel = TRUE, size = 2.5) +\n  labs(title = \"Entity Communication Network: People and Vessels\",\n       color = \"Group\", shape = \"Type\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex03_files/figure-html/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n\n# 2A Interactive graph\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ---- NODES PREPARATION ----\nnodes_vis <- graph_tbl %>%\n  activate(nodes) %>% \n  as_tibble() %>%\n  mutate(\n    id = as.character(id),  # Ensure character type\n    label = name,\n    group = group,\n    shape = ifelse(sub_type == \"Person\", \"dot\", \"triangle\"),\n    title = paste0(\n      \"<div style='color:white;'>\",  # Changed text color to white\n      \"<b>\", name, \"</b><br>\",\n      \"Type: \", sub_type, \"<br>\",\n      \"Group: \", group,\n      \"</div>\"\n    )\n  ) %>%\n  select(id, label, group, shape, title)\n\n# ---- EDGES PREPARATION ----\nnode_id_map <- graph_tbl %>% \n  activate(nodes) %>% \n  as_tibble() %>% \n  mutate(node_index = row_number()) %>% \n  select(node_index, id)\n\nedges_vis <- graph_tbl %>%\n  activate(edges) %>% \n  as_tibble() %>%\n  left_join(node_id_map, by = c(\"from\" = \"node_index\")) %>%\n  rename(from_id = id) %>%\n  left_join(node_id_map, by = c(\"to\" = \"node_index\")) %>%\n  rename(to_id = id) %>%\n  select(from = from_id, to = to_id)\n\n# ---- INTERACTIVE VISUALIZATION ----\nvisNetwork(nodes_vis, edges_vis, width = \"100%\", height = \"800px\") %>%\n  visIgraphLayout(layout = \"layout_with_fr\") %>%\n  visNodes(\n    font = list(size = 18, color = \"black\"),\n    shadow = list(enabled = TRUE, size = 10)\n  ) %>%\n  visEdges(\n    color = list(color = \"rgba(100,100,100,0.5)\", highlight = \"red\"),\n    smooth = FALSE\n  ) %>%\n  visInteraction(\n    tooltipStyle = 'position: fixed; visibility: hidden; padding: 8px;\n                   font-family: verdana; font-size:14px; color: white;\n                   background-color: black; border-radius: 5px;\n                   border: 1px solid #444; box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);\n                   max-width: 300px; word-break: break-word;'\n  ) %>%\n  visOptions(\n    highlightNearest = list(enabled = TRUE, degree = 1),\n    nodesIdSelection = TRUE,\n    selectedBy = \"group\"\n  ) %>%\n  visLegend(\n    position = \"right\",\n    main = \"Group Legend\",\n    useGroups = TRUE\n  ) %>%\n  visGroups(groupname = \"Environmentalism\", color = \"#4DAF4A\") %>%\n  visGroups(groupname = \"Sailor Shift\", color = \"#E41A1C\") %>%\n  visGroups(groupname = \"Fishing/Leisure\", color = \"#377EB8\") %>%\n  visGroups(groupname = \"Tourism/Leisure\", color = \"#FFD700\") %>%\n  visGroups(groupname = \"Vessel\", color = \"#A65628\") %>% \n  visGroups(groupname = \"Person\", color = \"#984EA3\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-94db6590713f53027b1f\" style=\"width:100%;height:800px;\" class=\"visNetwork html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-94db6590713f53027b1f\">{\"x\":{\"nodes\":{\"id\":[\"Sam\",\"Kelly\",\"Nadia Conti\",\"Elise\",\"Liam Thorne\",\"Samantha Blake\",\"Davis\",\"Rodriguez\",\"Sailor Shift\",\"Clepper Jensen\",\"Miranda Jordan\",\"The Intern\",\"The Lookout\",\"The Accountant\",\"Mrs. Money\",\"The Middleman\",\"Boss\",\"Small Fry\",\"Neptune\",\"Marlin\",\"Serenity\",\"Mako\",\"Reef Guardian\",\"Horizon\",\"Seawatch\",\"EcoVigil\",\"Sentinel\",\"Osprey\",\"Defender\",\"Northern Light\",\"Remora\",\"Knowles\",\"Mariner's Dream\"],\"label\":[\"Sam\",\"Kelly\",\"Nadia Conti\",\"Elise\",\"Liam Thorne\",\"Samantha Blake\",\"Davis\",\"Rodriguez\",\"Sailor Shift\",\"Clepper Jensen\",\"Miranda Jordan\",\"The Intern\",\"The Lookout\",\"The Accountant\",\"Mrs. Money\",\"The Middleman\",\"Boss\",\"Small Fry\",\"Neptune\",\"Marlin\",\"Serenity\",\"Mako\",\"Reef Guardian\",\"Horizon\",\"Seawatch\",\"EcoVigil\",\"Sentinel\",\"Osprey\",\"Defender\",\"Northern Light\",\"Remora\",\"Knowles\",\"Mariner's Dream\"],\"group\":[\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Sailor Shift\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Person\",\"Tourism/Leisure\",\"Fishing/Leisure\",\"Tourism/Leisure\",\"Tourism/Leisure\",\"Environmentalism\",\"Tourism/Leisure\",\"Vessel\",\"Environmentalism\",\"Environmentalism\",\"Tourism/Leisure\",\"Vessel\",\"Vessel\",\"Tourism/Leisure\",\"Vessel\",\"Vessel\"],\"shape\":[\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"dot\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\",\"triangle\"],\"title\":[\"<div style='color:white;'><b>Sam<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Kelly<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Nadia Conti<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Elise<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Liam Thorne<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Samantha Blake<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Davis<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Rodriguez<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Sailor Shift<\\/b><br>Type: Person<br>Group: Sailor Shift<\\/div>\",\"<div style='color:white;'><b>Clepper Jensen<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Miranda Jordan<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>The Intern<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>The Lookout<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>The Accountant<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Mrs. Money<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>The Middleman<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Boss<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Small Fry<\\/b><br>Type: Person<br>Group: Person<\\/div>\",\"<div style='color:white;'><b>Neptune<\\/b><br>Type: Vessel<br>Group: Tourism/Leisure<\\/div>\",\"<div style='color:white;'><b>Marlin<\\/b><br>Type: Vessel<br>Group: Fishing/Leisure<\\/div>\",\"<div style='color:white;'><b>Serenity<\\/b><br>Type: Vessel<br>Group: Tourism/Leisure<\\/div>\",\"<div style='color:white;'><b>Mako<\\/b><br>Type: Vessel<br>Group: Tourism/Leisure<\\/div>\",\"<div style='color:white;'><b>Reef Guardian<\\/b><br>Type: Vessel<br>Group: Environmentalism<\\/div>\",\"<div style='color:white;'><b>Horizon<\\/b><br>Type: Vessel<br>Group: Tourism/Leisure<\\/div>\",\"<div style='color:white;'><b>Seawatch<\\/b><br>Type: Vessel<br>Group: Vessel<\\/div>\",\"<div style='color:white;'><b>EcoVigil<\\/b><br>Type: Vessel<br>Group: Environmentalism<\\/div>\",\"<div style='color:white;'><b>Sentinel<\\/b><br>Type: Vessel<br>Group: Environmentalism<\\/div>\",\"<div style='color:white;'><b>Osprey<\\/b><br>Type: Vessel<br>Group: Tourism/Leisure<\\/div>\",\"<div style='color:white;'><b>Defender<\\/b><br>Type: Vessel<br>Group: Vessel<\\/div>\",\"<div style='color:white;'><b>Northern Light<\\/b><br>Type: Vessel<br>Group: Vessel<\\/div>\",\"<div style='color:white;'><b>Remora<\\/b><br>Type: Vessel<br>Group: Tourism/Leisure<\\/div>\",\"<div style='color:white;'><b>Knowles<\\/b><br>Type: Vessel<br>Group: Vessel<\\/div>\",\"<div style='color:white;'><b>Mariner's Dream<\\/b><br>Type: Vessel<br>Group: Vessel<\\/div>\"],\"x\":[0.6459140066405133,0.924146382892068,-0.4868022234157402,-0.2971351447483092,-0.2140979901832551,-0.768437381026746,-0.7902762969765456,-0.7164481460369175,-0.2460445092693689,0.8890813469274583,1,0.1127874234659589,0.2011254929635293,-0.5175669582523099,-0.3939567289271738,-0.3475416503968272,-0.5402607241313451,-0.963223071828986,-0.484221228509309,-0.6640929343597528,-0.504577745659885,-0.5585093930643148,-0.2496087679385791,-0.05425620469036374,-0.06557018147588267,-0.01002251421007672,-0.1469528790531645,-0.9594402778385825,-0.3249638081428239,-0.8988993500818053,-0.682937206131355,-1,0.3264471219623066],\"y\":[0.2716706885856697,0.3417194385951725,0.4191146181334637,0.4049889100560951,0.6238215020903604,-0.2044335732366279,0.4138769923717072,0.6161838413073657,-1,-0.4454773838262113,-0.2915967014852148,0.5391705529383424,0.2160846210924314,1,0.5504466818230411,0.8503119940076562,0.6600385456746878,0.3349298915881016,0.2820968939601822,0.1729980683992243,-0.02729253595945835,0.1812560830332806,0.08131172873866266,0.07509688492443201,-0.1218830063494151,0.3164279463144306,0.1763892694834965,-0.07704494728606337,-0.1569915172060961,-0.9035099051703173,0.4024133171760431,0.1807298569011442,-0.8731267251733201]},\"edges\":{\"from\":[\"Sam\",\"Sam\",\"Nadia Conti\",\"Nadia Conti\",\"Nadia Conti\",\"Nadia Conti\",\"Elise\",\"Nadia Conti\",\"Elise\",\"Liam Thorne\",\"Liam Thorne\",\"Samantha Blake\",\"Davis\",\"Davis\",\"Nadia Conti\",\"Davis\",\"Davis\",\"Rodriguez\",\"Davis\",\"Rodriguez\",\"Nadia Conti\",\"Rodriguez\",\"Clepper Jensen\",\"Clepper Jensen\",\"The Intern\",\"The Intern\",\"The Intern\",\"Sam\",\"The Lookout\",\"The Lookout\",\"The Lookout\",\"The Accountant\",\"The Accountant\",\"Mrs. Money\",\"Mrs. Money\",\"The Intern\",\"Mrs. Money\",\"Mrs. Money\",\"Mrs. Money\",\"The Middleman\",\"Mrs. Money\",\"Liam Thorne\",\"The Accountant\",\"Mrs. Money\",\"The Middleman\",\"Boss\",\"Small Fry\",\"Small Fry\",\"Davis\",\"Neptune\",\"Neptune\",\"Neptune\",\"Elise\",\"Neptune\",\"Nadia Conti\",\"Davis\",\"Marlin\",\"Marlin\",\"Marlin\",\"Serenity\",\"Serenity\",\"Neptune\",\"Serenity\",\"Mako\",\"Marlin\",\"Mako\",\"Mako\",\"Mako\",\"Davis\",\"Boss\",\"Samantha Blake\",\"Neptune\",\"Elise\",\"Serenity\",\"Reef Guardian\",\"Mako\",\"Marlin\",\"Reef Guardian\",\"Reef Guardian\",\"Neptune\",\"Reef Guardian\",\"Reef Guardian\",\"Horizon\",\"Horizon\",\"Mako\",\"Horizon\",\"Reef Guardian\",\"Reef Guardian\",\"Horizon\",\"Reef Guardian\",\"Liam Thorne\",\"EcoVigil\",\"Horizon\",\"Mako\",\"Reef Guardian\",\"Nadia Conti\",\"Seawatch\",\"Mako\",\"Reef Guardian\",\"Seawatch\",\"Mako\",\"Rodriguez\",\"Mako\",\"Neptune\",\"Davis\",\"Nadia Conti\",\"Mako\",\"Davis\",\"Sam\",\"Marlin\",\"Small Fry\",\"Small Fry\",\"Seawatch\",\"The Lookout\",\"Rodriguez\",\"Davis\",\"Mako\",\"Elise\",\"Mrs. Money\",\"Elise\",\"Mrs. Money\",\"Liam Thorne\",\"Nadia Conti\",\"Nadia Conti\",\"Mrs. Money\",\"Rodriguez\",\"Nadia Conti\",\"The Lookout\",\"Horizon\",\"Nadia Conti\",\"The Accountant\",\"Liam Thorne\",\"The Lookout\",\"Nadia Conti\",\"Davis\",\"Nadia Conti\",\"Davis\",\"Seawatch\",\"EcoVigil\",\"Mako\",\"Mako\",\"Davis\"],\"to\":[\"Kelly\",\"Kelly\",\"Liam Thorne\",\"Neptune\",\"Marlin\",\"Elise\",\"Liam Thorne\",\"Liam Thorne\",\"Liam Thorne\",\"Boss\",\"EcoVigil\",\"Mako\",\"Mako\",\"Remora\",\"Davis\",\"Neptune\",\"Boss\",\"Boss\",\"Rodriguez\",\"Mrs. Money\",\"Rodriguez\",\"Remora\",\"Miranda Jordan\",\"Miranda Jordan\",\"The Lookout\",\"Mrs. Money\",\"The Lookout\",\"The Lookout\",\"Sentinel\",\"Horizon\",\"Reef Guardian\",\"Boss\",\"The Middleman\",\"Boss\",\"The Middleman\",\"Mrs. Money\",\"Neptune\",\"Mako\",\"Remora\",\"Boss\",\"The Middleman\",\"The Middleman\",\"The Middleman\",\"Boss\",\"Boss\",\"Mako\",\"Mako\",\"Remora\",\"Small Fry\",\"Mako\",\"Serenity\",\"Remora\",\"Neptune\",\"Reef Guardian\",\"Neptune\",\"Neptune\",\"Mako\",\"Remora\",\"Reef Guardian\",\"Mako\",\"Reef Guardian\",\"Serenity\",\"Mako\",\"Remora\",\"Mako\",\"Osprey\",\"Reef Guardian\",\"Sentinel\",\"Mako\",\"Mako\",\"Mako\",\"Mako\",\"Mako\",\"Reef Guardian\",\"Defender\",\"Reef Guardian\",\"Reef Guardian\",\"Horizon\",\"Sentinel\",\"Reef Guardian\",\"EcoVigil\",\"Seawatch\",\"Sentinel\",\"EcoVigil\",\"Horizon\",\"Seawatch\",\"Horizon\",\"Seawatch\",\"EcoVigil\",\"EcoVigil\",\"EcoVigil\",\"Sentinel\",\"Sentinel\",\"Sentinel\",\"Sentinel\",\"Sentinel\",\"Sentinel\",\"Osprey\",\"Defender\",\"Defender\",\"Defender\",\"Remora\",\"Remora\",\"Remora\",\"Remora\",\"Remora\",\"Knowles\",\"Knowles\",\"The Lookout\",\"Remora\",\"Mako\",\"Remora\",\"Defender\",\"Sentinel\",\"Boss\",\"Rodriguez\",\"Horizon\",\"Neptune\",\"Neptune\",\"Mako\",\"Mako\",\"The Middleman\",\"Davis\",\"Elise\",\"Remora\",\"Mrs. Money\",\"Marlin\",\"Horizon\",\"Seawatch\",\"Sentinel\",\"Boss\",\"Boss\",\"Reef Guardian\",\"Rodriguez\",\"Small Fry\",\"Remora\",\"Boss\",\"Sentinel\",\"Sentinel\",\"Knowles\",\"Defender\",\"Knowles\"]},\"nodesToDataframe\":true,\"edgesToDataframe\":true,\"options\":{\"width\":\"100%\",\"height\":\"100%\",\"nodes\":{\"shape\":\"dot\",\"physics\":false,\"font\":{\"size\":18,\"color\":\"black\"},\"shadow\":{\"enabled\":true,\"size\":10}},\"manipulation\":{\"enabled\":false},\"edges\":{\"color\":{\"color\":\"rgba(100,100,100,0.5)\",\"highlight\":\"red\"},\"smooth\":false},\"physics\":{\"stabilization\":false},\"interaction\":{\"zoomSpeed\":1},\"groups\":{\"Environmentalism\":{\"color\":\"#4DAF4A\"},\"Sailor Shift\":{\"color\":\"#E41A1C\"},\"Fishing/Leisure\":{\"color\":\"#377EB8\"},\"Tourism/Leisure\":{\"color\":\"#FFD700\"},\"Vessel\":{\"color\":\"#A65628\"},\"useDefaultGroups\":true,\"Person\":{\"color\":\"#984EA3\"}}},\"groups\":[\"Person\",\"Sailor Shift\",\"Tourism/Leisure\",\"Fishing/Leisure\",\"Environmentalism\",\"Vessel\"],\"width\":\"100%\",\"height\":\"800px\",\"idselection\":{\"enabled\":true,\"style\":\"width: 150px; height: 26px\",\"useLabels\":true,\"main\":\"Select by id\"},\"byselection\":{\"enabled\":true,\"style\":\"width: 150px; height: 26px\",\"multiple\":false,\"hideColor\":\"rgba(200,200,200,0.5)\",\"highlight\":false,\"variable\":\"group\",\"main\":\"Select by group\",\"values\":[\"Environmentalism\",\"Fishing/Leisure\",\"Person\",\"Sailor Shift\",\"Tourism/Leisure\",\"Vessel\"]},\"main\":null,\"submain\":null,\"footer\":null,\"background\":\"rgba(0, 0, 0, 0)\",\"igraphlayout\":{\"type\":\"square\"},\"tooltipStay\":300,\"tooltipStyle\":\"position: fixed; visibility: hidden; padding: 8px;\\n                   font-family: verdana; font-size:14px; color: white;\\n                   background-color: black; border-radius: 5px;\\n                   border: 1px solid #444; box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);\\n                   max-width: 300px; word-break: break-word;\",\"highlight\":{\"enabled\":true,\"hoverNearest\":false,\"degree\":1,\"algorithm\":\"all\",\"hideColor\":\"rgba(200,200,200,0.5)\",\"labelOnly\":true},\"collapse\":{\"enabled\":false,\"fit\":false,\"resetHighlight\":true,\"clusterOptions\":null,\"keepCoord\":true,\"labelSuffix\":\"(cluster)\"},\"legend\":{\"width\":0.2,\"useGroups\":true,\"position\":\"right\",\"ncol\":1,\"stepX\":100,\"stepY\":100,\"zoom\":true,\"main\":{\"text\":\"Group Legend\",\"style\":\"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:14px;text-align:center;\"}}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n# Cluster Analysis \n\n::: {.cell}\n\n```{.r .cell-code}\n# ---- CLUSTER ANALYSIS (FIXED) ----\ngraph_igraph <- as.igraph(graph_tbl)\n\n# Check graph connectivity and get component info\ncomponents <- components(graph_igraph)\nlargest_comp <- which.max(components$csize)\nnode_indices <- which(components$membership == largest_comp)\n\n# Compute clusters\ncluster_infomap <- cluster_infomap(graph_igraph)\ncluster_louvain <- cluster_louvain(graph_igraph)\ncluster_walktrap <- cluster_walktrap(graph_igraph, steps = 10)\ncluster_edge_betweenness <- cluster_edge_betweenness(graph_igraph, directed = FALSE)\n\n# Spinglass only on largest component\ngraph_connected <- induced_subgraph(graph_igraph, node_indices)\ncluster_spinglass <- cluster_spinglass(graph_connected)\n\n# Create aligned cluster vectors\nspinglass_vec <- rep(NA, vcount(graph_igraph))\nspinglass_vec[node_indices] <- membership(cluster_spinglass)\n\n# Add cluster memberships to nodes\nentity_nodes <- entity_nodes %>%\n  mutate(\n    infomap_cluster = as.factor(membership(cluster_infomap)),\n    louvain_cluster = as.factor(membership(cluster_louvain)),\n    walktrap_cluster = as.factor(membership(cluster_walktrap)),\n    edge_betweenness_cluster = as.factor(membership(cluster_edge_betweenness)),\n    spinglass_cluster = as.factor(spinglass_vec)\n  )\n\n\n# ---- VISUALIZE CLUSTERS (example: Infomap) ----\ngraph_tbl_clustered <- graph_tbl %>%\n  left_join(entity_nodes %>% select(id, infomap_cluster), by = \"id\")\n\nggraph(graph_tbl_clustered, layout = \"fr\") +\n  geom_edge_link(alpha = 0.1, color = \"gray\") +\n  geom_node_point(aes(color = infomap_cluster, shape = sub_type), size = 5) +\n  geom_node_text(aes(label = name), repel = TRUE, size = 3) +\n  labs(title = \"Infomap Clustering\", color = \"Cluster\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex03_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ---- CLUSTER METRICS TABLE ----\ncluster_metrics <- tibble(\n  Algorithm = c(\"Infomap\", \"Louvain\", \"Walktrap\", \"Edge Betweenness\", \"Spinglass\"),\n  Clusters = c(length(unique(membership(cluster_infomap))),\n               length(unique(membership(cluster_louvain))),\n               length(unique(membership(cluster_walktrap))),\n               length(unique(membership(cluster_edge_betweenness))),\n               length(unique(membership(cluster_spinglass)))),\n  Modularity = c(modularity(cluster_infomap),\n                 modularity(cluster_louvain),\n                 modularity(cluster_walktrap),\n                 modularity(cluster_edge_betweenness),\n                 modularity(cluster_spinglass))\n)\n\nprint(cluster_metrics)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 Ã— 3\n  Algorithm        Clusters Modularity\n  <chr>               <int>      <dbl>\n1 Infomap                15      0.143\n2 Louvain                 7      0.359\n3 Walktrap                7      0.304\n4 Edge Betweenness       10      0.342\n5 Spinglass               4      0.262\n```\n:::\n:::\n\n\n\n# Algorithm Bar charts\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create metrics comparison plots\ncluster_metrics <- tibble(\n  Algorithm = c(\"Infomap\", \"Louvain\", \"Walktrap\", \"Edge Betweenness\", \"Spinglass\"),\n  Clusters = c(13, 7, 7, 10, 5),\n  Modularity = c(0.1472922, 0.3585598, 0.3040071, 0.3416981, 0.2318878)\n)\n\n# Clusters comparison\np1 <- ggplot(cluster_metrics, aes(x = reorder(Algorithm, Clusters), y = Clusters, fill = Algorithm)) +\n  geom_col(alpha = 0.8) +\n  geom_text(aes(label = Clusters), vjust = -0.5, size = 4, fontface = \"bold\") +\n  labs(title = \"Number of Clusters by Algorithm\", \n       x = \"Algorithm\", y = \"Number of Clusters\") +\n  theme_minimal() +\n  theme(legend.position = \"none\", axis.text.x = element_text(angle = 45, hjust = 1)) +\n  scale_fill_brewer(palette = \"Set2\")\n\n# Modularity comparison\np2 <- ggplot(cluster_metrics, aes(x = reorder(Algorithm, -Modularity), y = Modularity, fill = Algorithm)) +\n  geom_col(alpha = 0.8) +\n  geom_text(aes(label = round(Modularity, 3)), vjust = -0.5, size = 4, fontface = \"bold\") +\n  labs(title = \"Modularity Score by Algorithm\", \n       x = \"Algorithm\", y = \"Modularity Score\") +\n  theme_minimal() +\n  theme(legend.position = \"none\", axis.text.x = element_text(angle = 45, hjust = 1)) +\n  scale_fill_brewer(palette = \"Set2\")\n\n# Combined plot\np1 + p2 + plot_layout(ncol = 2)\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex03_files/figure-html/unnamed-chunk-15-1.png){width=576}\n:::\n:::",
    "supporting": [
      "Take-Home_Ex03_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\r\n<link href=\"../../site_libs/vis-9.1.0/vis-network.min.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/vis-9.1.0/vis-network.min.js\"></script>\r\n<script src=\"../../site_libs/visNetwork-binding-2.1.2/visNetwork.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}